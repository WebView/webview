cmake_minimum_required(VERSION 2.8)

project(webview)

if(APPLE)
	set(WEBVIEW_COMPILE_DEFS "-DWEBVIEW_COCOA=1")
	set(WEBVIEW_COMPILE_OPTS "-x" "objective-c")
	set(WEBVIEW_LIBS "-framework Cocoa" "-framework WebKit")
elseif(MSVC)
	set(WEBVIEW_COMPILE_DEFS "-DWEBVIEW_WINAPI=1")
	set (CMAKE_C_FLAGS "/D_CRT_SECURE_NO_WARNINGS /D_CRT_SECURE_NO_DEPRECATE ${CMAKE_C_FLAGS}")
elseif(WIN32)
	set(WEBVIEW_COMPILE_DEFS "-DWEBVIEW_WINAPI=1")
	set(WEBVIEW_LIBS "ole32 comctl32 oleaut32 uuid")
else()
	set(WEBVIEW_COMPILE_DEFS "-DWEBVIEW_GTK=1")
	find_package(PkgConfig REQUIRED)
	pkg_check_modules(GTK3 REQUIRED gtk+-3.0)
	pkg_check_modules(WEBKIT REQUIRED webkit2gtk-4.0)
	set(WEBVIEW_COMPILE_INCS ${GTK3_INCLUDE_DIRS} ${WEBKIT_INCLUDE_DIRS} ${PROJECT_SOURCE_DIR})
	set(WEBVIEW_LIBS ${GTK3_LIBRARIES} ${WEBKIT_LIBRARIES})
endif()

add_library(webview INTERFACE)
target_include_directories(webview INTERFACE ${PROJECT_SOURCE_DIR} ${WEBVIEW_COMPILE_INCS})
target_sources(webview INTERFACE "${PROJECT_SOURCE_DIR}/webview.h")
target_compile_definitions(webview INTERFACE ${WEBVIEW_COMPILE_DEFS})
target_compile_options(webview INTERFACE ${WEBVIEW_COMPILE_OPTS})
target_link_libraries(webview INTERFACE ${WEBVIEW_LIBS})

if(MSVC)
	add_library(webview_i SHARED webview.c)
	target_include_directories(webview_i PRIVATE ${PROJECT_SOURCE_DIR} ${WEBVIEW_COMPILE_INCS})
	target_compile_definitions(webview_i PRIVATE ${WEBVIEW_COMPILE_DEFS})
	target_compile_options(webview_i PRIVATE ${WEBVIEW_COMPILE_OPTS})
	target_link_libraries(webview_i ${WEBVIEW_LIBS})
	if (CMAKE_SIZEOF_VOID_P EQUAL 8) 
		set_target_properties (webview_i PROPERTIES RUNTIME_OUTPUT_NAME webview_w64)
	else()
		set_target_properties (webview_i PROPERTIES RUNTIME_OUTPUT_NAME webview_w32)
	endif()
else()
	add_library(webview_shared SHARED webview.c)
	target_include_directories(webview_shared PRIVATE ${PROJECT_SOURCE_DIR} ${WEBVIEW_COMPILE_INCS})
	target_compile_definitions(webview_shared PRIVATE ${WEBVIEW_COMPILE_DEFS})
	target_compile_options(webview_shared PRIVATE ${WEBVIEW_COMPILE_OPTS})
	target_link_libraries(webview_shared ${WEBVIEW_LIBS})
endif()
